services:
  - type: web
    name: rag-playground-api
    env: python
    plan: free
    autoDeploy: true
    rootDir: apps/api
    buildCommand: >
      pip install --upgrade pip &&
      pip install poetry &&
      poetry install --no-interaction --only main
    startCommand: >
      poetry run uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /api/health
    envVars:
      - key: EMBEDDINGS_PROVIDER
        value: openai
      - key: OPENAI_API_KEY
        sync: false
      - key: RERANK_STRATEGY
        value: ce
      - key: ANSWER_MODE_DEFAULT
        value: grounded
      - key: ANSWER_CONFIDENCE_ENABLED
        value: "true"
      - key: GOOGLE_AUTH_ENABLED
        value: "false"
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: ADMIN_GOOGLE_EMAIL
        sync: false
      - key: SESSION_SECRET
        sync: false
      - key: CORS_ALLOWED_ORIGINS
        value: ""
  - type: web
    name: rag-playground-web
    env: node
    plan: free
    autoDeploy: true
    rootDir: apps/web
    buildCommand: >
      corepack enable pnpm &&
      pnpm install --frozen-lockfile &&
      pnpm build
    startCommand: >
      pnpm exec next start -p $PORT
    envVars:
      - key: NEXT_PUBLIC_API_BASE_URL
        fromService:
          name: rag-playground-api
          type: web
          property: url
      - key: NEXT_PUBLIC_GOOGLE_AUTH_ENABLED
        value: "false"
      - key: NEXT_PUBLIC_GOOGLE_CLIENT_ID
        sync: false
